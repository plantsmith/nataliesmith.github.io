{
  "hash": "78dc9aad184adefb21afce5c1f290162",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Understanding Adult Fish Passage Dynamics at Willamette Falls\"\ndescription: \"Time series and seasonality analysis of adult passage for Coho, Jack Coho, and Steelhead from 2001 to 2010.\"\nauthor: \"Natalie Smith\"\ndate: 01-30-2024\ncategories: [Trends]\nformat:\n  html:\n    code-fold: true\nexecute:\n  echo: true\n  message: false\n  warning: false\ndraft: false # \"true\" will mean this is a draft post so it won't show up on my site\nfreeze: true\n---\n\n\n\n# Overview\n\nIn my analysis, I delved into the adult passage of Coho, Coho Jack, and Steelhead from 2001-2010 at the Willamette Falls fish ladder on the Willamette River (Oregon) using data from Columbia River DART (Data Access in Real Time). My focus was on identifying patterns and trends in fish passage based on time and season. Additionally, I aimed to determine the annual counts for each species.\n\n![Adult Male Coho Salmon, BLM](coho.jpeg)\n\n# Part 1: Original Time Series\n\n## Attach libraries:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(here)\nlibrary(tsibble)\nlibrary(feasts)\nlibrary(fable)\nlibrary(ggplot2)\nlibrary(tidyr)\nlibrary(viridis)\nlibrary(showtext) \nlibrary(glue)\nlibrary(ggtext)\n\n\n#......................import Google fonts.......................\n# `name` is the name of the font as it appears in Google Fonts\n# `family` is the user-specified id that you'll use to apply a font in your ggpplot\nfont_add_google(name = \"Montserrat\", family = \"mont\")\nfont_add_google(name = \"Open Sans\", family = \"open_sans\")\n\n\n\n# turn show text on\nshowtext_auto()\n```\n:::\n\n\n\n## Import and Wrangle Data:\n\nIn preparing the data, I transformed it into a time series format and converted the date column from character to date format. I then pivoted the data to consolidate fish species into a single column for streamlined analysis. Finally, any missing values were replaced with zeros to ensure data integrity.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Import Data\n\nwillamette_fish <- read.csv(here(\"portfolio\",\"fish_passage\",\"willamette_fish_passage.csv\"))\n\n# Clean up data\nwf_clean <- willamette_fish %>%\n  janitor::clean_names() %>% \n  mutate(date=lubridate::mdy(date)) %>% \n  as_tsibble(key=NULL,index=date) %>% \n  pivot_longer(!c(project,date),names_to = \"species\",values_to = \"number_of_salmon\") %>% \n  filter(species %in% c(\"coho\",\"jack_coho\",\"steelhead\")) %>% \n  replace_na(list(fish_ob=0))\n```\n:::\n\n\n\n## Time Series Graph:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(wf_clean, aes(x = date, y = number_of_salmon, color = species)) +\n  geom_line(size = 1.1, alpha = 0.9) +\n  scale_x_date(date_breaks = \"1 year\", date_labels = \"%Y\") +\n  scale_color_viridis_d(name = \"Species\", option = \"D\") +\n  \n  facet_wrap(~ species, scales = \"free_y\", ncol = 1, labeller = as_labeller(\n    c(\"coho\" = \"Coho\", \"jack_coho\" = \"Jack Coho\", \"steelhead\" = \"Steelhead\"))) +\n\n# LABS ----\n  labs(\n    title = \"Seasonal Fish Passage at Willamette Falls (2001–2010)\",\n    subtitle = \"Coho migrate in fall while Steelhead show prolonged passage from winter through spring.\",\n    caption = \"Source: Columbia River DART\",\n    x = \"Year\",\n    y = \"Fish Count\"\n  ) +\n\n# THEMES ----\n  theme_minimal()+\n  \n  theme(\n    plot.title.position = \"plot\",\n    plot.title = element_text(family = \"sans\", \n                              face = \"bold\", \n                              size = 18, \n                              color = \"black\",\n                              margin = margin(b=0.75)),\n    \n    plot.subtitle = ggtext::element_textbox(family = \"sans\", \n                                            size = 11.5, \n                                            margin = margin(t = 1, b = 6)),\n    \n    plot.caption = ggtext::element_textbox(family = \"sans\", \n                                           face = \"italic\", \n                                           margin = margin(t = 15)),\n    \n\n    strip.text = element_text(\n                            # face = \"bold\",\n                            size = 10, \n                            hjust = 0),  # Left-align facet strip text\n\n    # axis.text.x = element_text(angle = 45, hjust = 1),\n    axis.title.x = element_text(margin = margin(t = 10), family = \"sans\"),  # t = top spacing in points\n    panel.spacing = unit(1, \"lines\"),\n    legend.position = \"none\",\n    plot.margin = margin(10, 10, 10, 10)\n  )\n```\n\n::: {.cell-output-display}\n![Time series analysis of adult passage for Coho, Jack Coho, and Steelhead Salmon from 2001 to 2010.](index_files/figure-html/fig-time-series-1.png){#fig-time-series width=672}\n:::\n:::\n\n\n\n### Major patterns and notable trends:\n\nCoho species exhibit a left-skewed pattern, with passage counts consistently increasing since 2009. Jack Coho species display a more uniform distribution, reaching peak passage counts in 2009. Steelhead demonstrate a consistent seasonal pattern throughout the analyzed time period.\n\n# Part 2: Seasonplots\n\n## Monthly and Weekly Seasonal Patterns:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwf_season <-wf_clean %>%\n  group_by(species) %>%\n  summarize(monthly_count=sum(number_of_salmon))\n\n  \n wf_season %>% gg_season(y=monthly_count, pal = viridis::viridis(8))+\n  facet_wrap(~ species, scales = \"free_y\", ncol = 1, \n             labeller = as_labeller(c(\n               \"coho\" = \"Coho\",\n               \"jack_coho\" = \"Jack Coho\",\n               \"steelhead\" = \"Steelhead\"\n))) +\n     scale_x_date(date_breaks = \"1 month\", date_labels = \"%b\") +\n   \n#labs ---\n   labs(\n    title = \"Monthly Fish Passage at Willamette Falls (2001–2010)\",\n    subtitle = \"Monthly fish passage patterns vary by species, with sharp fall peaks <br> for Coho and extended migration periods for Steelhead.\",\n    x = \"Month\",\n    y = \"Fish Count\",\n    caption = \"Source: Columbia River DART\"\n  ) +\n\n   \n  theme_minimal() +\n     theme(\n    plot.title.position = \"plot\",\n    plot.title = element_text(family = \"sans\", \n                              face = \"bold\", \n                              size = 18, \n                              color = \"black\",\n                              margin = margin(b=0)),\n    \n    plot.subtitle = ggtext::element_markdown(family = \"sans\", \n                                            size = 11.5, \n                                            margin = margin(t = 0, b = 6)),\n    \n    plot.caption = ggtext::element_textbox(family = \"sans\", \n                                           face = \"italic\", \n                                           margin = margin(t = 15)),\n    \n\n    strip.text = element_text(\n                            # face = \"bold\",\n                            size = 10, \n                            hjust = 0),  # Left-align facet strip text\n\n    axis.title.x = element_text(margin = margin(t = 10), family = \"sans\"),  # t = top spacing in points\n    panel.spacing = unit(1, \"lines\"),\n    plot.margin = margin(10, 10, 10, 10)\n  )\n```\n\n::: {.cell-output-display}\n![Total monthly returns of Salmon at Williamette River Dam. Lighter colors indicate later years with darker colors showing earlier years.](index_files/figure-html/fig-seasonal-patterns-1.png){#fig-seasonal-patterns width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nwf_weekly <- wf_clean %>%\n  index_by(yr_mo=~yearweek(.)) %>% \n  group_by(species) %>% \n  summarize(monthly_count=sum(number_of_salmon))   \n  \nwf_weekly %>% gg_season(y=monthly_count, pal = viridis::viridis(8))+\n  facet_wrap(~ species, scales = \"free_y\", ncol = 1, \n             labeller = as_labeller(c(\n               \"coho\" = \"Coho\",\n               \"jack_coho\" = \"Jack Coho\",\n               \"steelhead\" = \"Steelhead\"\n))) +\n  \n #labs ---\n   labs(\n    title = \"Weekly Patterns in Fish Passage at Willamette Falls\",\n    # subtitle = \"Seasonal trends across years for Coho, Jack Coho, and Steelhead\",\n    x = \"Month\",\n    y = \"Weekly\n    \n    Fish Passage\",\n    caption = \"Source: Columbia River DART\"\n  ) +\n  \n  #Theme \n    theme_minimal() +\n     theme(\n    plot.title.position = \"plot\",\n    plot.title = element_text(family = \"sans\", \n                              face = \"bold\", \n                              size = 18, \n                              color = \"black\"),\n    \n    plot.subtitle = element_text(family = \"sans\", \n                                            size = 11.5, \n                                            margin = margin(t = 2, b = 6)),\n    \n    plot.caption = ggtext::element_textbox(family = \"sans\", \n                                           face = \"italic\", \n                                           margin = margin(t = 15)),\n    \n\n    strip.text = element_text(\n                            # face = \"bold\",\n                            size = 10, \n                            hjust = 0),  # Left-align facet strip text\n\n    axis.title.x = element_text(margin = margin(t = 10), family = \"sans\"),  # t = top spacing in points\n    panel.spacing = unit(1, \"lines\"),\n    plot.margin = margin(10, 10, 10, 10)\n  )\n```\n\n::: {.cell-output-display}\n![Total weekly returns of Salmon at Williamette River Dam. Lighter colors indicate later years with darker colors showing earlier years.](index_files/figure-html/fig-week-1.png){#fig-week width=672}\n:::\n:::\n\n\n\n### Key Seasonal Trends:\n\n-   Coho and Jack Coho exhibit a similar seasonal pattern, peaking from September to November. Coho passage has increased in recent years, while Jack Coho passage has declined.\n\n-   Steelhead show a wider seasonal passage window, spanning from February to July, with a peak typically observed from May to July. The timing of peak passage varies across years.\n\n-   Late April and May mark the peak return period for Steelhead, although total returns during this period have declined over the years. This suggests a potential shift in the timing of returns, which is more evident when analyzing the data on a weekly basis.\n\n# Part 3: Annual Counts by Species\n\n## Approach:\n\nTo analyze annual counts for each species, I aggregated the data by year and fish species, calculating the total count for each year and species.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsalmon_by_year <- wf_clean%>%\n  group_by(year = lubridate::year(date),species) %>% \n  summarize(annual_count = sum(number_of_salmon)) %>% \n  ungroup()\n\nyear_count <- aggregate(annual_count ~ year + species, data = salmon_by_year, FUN = sum)\n```\n:::\n\n\n\n### Annual Count Graph:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nannual_salmon_plot_line <- year_count %>%\n  ggplot(aes(x = year, y = annual_count, color = species)) +\n  geom_line() + \n  scale_x_continuous(breaks = seq(min(salmon_by_year$year), max(salmon_by_year$year), by = 1)) +\n\n  #COLOR --\n  scale_color_viridis_d(\n  name = \"Species\",\n  labels = c(\n    \"coho\" = \"Coho\",\n    \"jack_coho\" = \"Jack Coho\",\n    \"steelhead\" = \"Steelhead\"\n  )\n) +\n\n#labs ---\n  labs(\n    title = \"Annual Fish Passage Totals at Willamette Falls (2000–2010)\",\n    subtitle = \"Steelhead consistently show the highest annual counts with high variability;<br>Coho increase notably after 2008, while Jack Coho remain low across all years.\",\n    x = \"Year\",\n    y = \"Fish Count\",\n    caption = \"Source: Columbia River DART\",\n    color = \"Species\"\n  ) +\n\n#Theme --\n  theme_minimal() +\n     theme(\n    plot.title.position = \"plot\",\n    plot.title = element_text(family = \"sans\", \n                              face = \"bold\", \n                              size = 18, \n                              color = \"black\",\n                              margin = margin(b=0)),\n    \n    plot.subtitle = ggtext::element_markdown(family = \"sans\", \n                                            size = 11.5, \n                                            margin = margin(t = 0, b = 6)),\n    \n    plot.caption = ggtext::element_textbox(family = \"sans\", \n                                           face = \"italic\", \n                                           margin = margin(t = 15)),\n    \n\n    strip.text = element_text(\n                            # face = \"bold\",\n                            size = 10, \n                            hjust = 0),  # Left-align facet strip text\n\n    axis.title.x = element_text(margin = margin(t = 10), family = \"sans\"),  # t = top spacing in points\n    panel.spacing = unit(1, \"lines\"),\n    plot.margin = margin(10, 10, 10, 10)\n  )\n\nannual_salmon_plot_line\n```\n\n::: {.cell-output-display}\n![Annual totals of fish passage for Coho, Jack Coho, and Steelhead Salmon from 2000 to 2010.](index_files/figure-html/fig-annual-count-1.png){#fig-annual-count width=672}\n:::\n:::\n\n\n\n### Key Trends in Annual Totals by Species (2000 - 2010):\n\n-   The Coho species demonstrates a left-skewed distribution, with a consistent increase over the years, peaking in 2009, followed by a decline in 2010.\n-   Jack Coho species displays a relatively uniform distribution, experiencing a gradual rise in species count from 2007, with a slight decline noted in 2010.\n-   Despite seasonal and annual increases and decreases, Steelhead populations are decreasing overall. The increase in 2009 may be a temporary improvement, but it's crucial to analyze more recent data to determine if this is a consistent upward trend or a small fluctuation.\n\n------------------------------------------------------------------------\n\n# Reference:\n\nU.S. Army Corps of Engineers, NWD and Chelan, Douglas, and Grant County PUDs, Yakima Klickitat Fisheries Project, Colville Tribes Fish & Wildlife (OBMEP), Oregon Department of Fish & Wildlife, Washington Department of Fish & Wildlife.\n\nAdult Passage Counts Queries. Willamette Falls fish Passage dataset. Retrieved from https://www.cbr.washington.edu/dart/query/adult_graph_text. Accessed on January 25, 2023.\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}