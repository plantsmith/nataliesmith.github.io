{
  "hash": "f87de0ebf304c5664d935d21bcac6caf",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Predicting Palmetto Species with Binary Logistic Regression\"\ndescription: \"Applying binary logistic regression to predict Palmetto species and evaluating model performance through repeated cross-validation\"\nauthor: \"Natalie Smith\"\ndate: 3-7-24\ncategories: [Modeling]\nimage: palms.jpg\nformat: \n  html:\n    code-fold: true\n    toc: true\n    number-sections: true\n    embed-resources: true\n# theme: Lux\neditor: visual\nexecute:\n  echo: true\n  message: false\n  warning: false\nfreeze: true\n---\n\n\n\n\n# Overview:\n\nThe palmetto data examines the survival, growth, and biomass estimates of two dominant palmetto species, *Serenoa repens* and *Sabal etonia*, in south Florida from 1981 to 2017, recorded at 5-year intervals. The dataset encompasses various variables, but for this analysis, we will focus on canopy height, length, and width, as well as green leaves.\n\nWe aim to create two models with different predictor variables and the better-performing model will be selected. We will then evaluate the success of the chosen model in correctly classifying a plant species.\n\n![Left: Sabal etonia, Right: Serenoa repens](palms.jpg)\n\n# Exploratory Plots:\n\nFirst we want to explore differences in the two species based on canopy height, canopy length, canopy width, and green leaves.\n\n### Add Libraries:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse) \nlibrary(here)\nlibrary(tidymodels) \nlibrary(ggplot2)\nlibrary(patchwork)\nlibrary(broom)\nlibrary(kableExtra)\n```\n:::\n\n\n\n\n### Import and Wrangle Data:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#pull in the data\np_df <- read.csv(here(\"portfolio/palms/data/palmetto.csv\"))\n\n#clean data\npalmetto <- p_df %>%\n  select(species,height,length,width,green_lvs) %>% \n  mutate(species=as_factor(species)) %>% \n  drop_na()\n```\n:::\n\n\n\n\n### Plots:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Species Boxplot ~ Green Leaves\nleaves_plot <- ggplot(palmetto, \n                     aes(x =as.factor(species),\n                         y = green_lvs)) +\n  geom_boxplot(fill = \"#ADD8E6\", color = \"#2E75B6\",\n               alpha = 0.8, \n               outlier.color = \"#FF5733\",\n               outlier.shape = 16, \n               outlier.size = 1) +  \n  scale_x_discrete(labels =\n                     expression(italic(\"S.repens\"),\n                                italic(\"S.etonia\"))) + \n  labs(x = \"Species\", y = \"Green Leaves\") +\n  theme_minimal() +\n  theme(\n    axis.title.y = element_text(size = 10),\n    axis.title.x = element_text(size = 10),\n    axis.text = element_text(size = 10),\n    legend.position = \"none\"\n  )\n# leaves_plot\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#Species Boxplot ~ Canopy Height\nheight_plot <- ggplot(palmetto, \n                     aes(x =as.factor(species),\n                         y = height)) +\n  geom_boxplot(fill = \"#ADD8E6\", color = \"#2E75B6\",\n               alpha = 0.8, \n               outlier.color = \"#FF5733\",\n               outlier.shape = 16, \n               outlier.size = 1) +  \n  scale_x_discrete(labels =\n                     expression(italic(\"S.repens\"),\n                                italic(\"S.etonia\"))) + \n  labs(x = \"Species\", y = \"Canopy Height\") +\n  theme_minimal() +\n  theme(\n    axis.title.y = element_text(size = 10),\n    axis.title.x = element_text(size = 10),\n    axis.text = element_text(size = 10),\n    legend.position = \"none\"\n  )\n# height_plot\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#Species Boxplot ~ Canopy Length\nlength_plot <- ggplot(palmetto, \n                     aes(x =as.factor(species),\n                         y = length)) +\n  geom_boxplot(fill = \"#ADD8E6\", color = \"#2E75B6\",\n               alpha = 0.8, \n               outlier.color = \"#FF5733\",\n               outlier.shape = 16, \n               outlier.size = 1) +  \n  scale_x_discrete(labels =\n                     expression(italic(\"S.repens\"),\n                                italic(\"S.etonia\"))) + \n  labs(x = \"Species\", y = \"Canopy Length\") +\n  theme_minimal() +\n  theme(\n    axis.title.y = element_text(size = 10),\n    axis.title.x = element_text(size = 10),\n    axis.text = element_text(size = 10),\n    legend.position = \"none\"\n  )\n# length_plot\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#Species Boxplot ~ Canopy Width\nwidth_plot <- ggplot(palmetto, \n                     aes(x =as.factor(species),\n                         y = width)) +\n  geom_boxplot(fill = \"#ADD8E6\", color = \"#2E75B6\",\n               alpha = 0.8, \n               outlier.color = \"#FF5733\",\n               outlier.shape = 16, \n               outlier.size = 1) +  \n  scale_x_discrete(labels =\n                     expression(italic(\"S.repens\"),\n                                italic(\"S.etonia\"))) + \n  labs(x = \"Species\", y = \"Canopy Width\") +\n  theme_minimal() +\n  theme(\n    axis.title.y = element_text(size = 10),\n    axis.title.x = element_text(size = 10),\n    axis.text = element_text(size = 10),\n    legend.position = \"none\"\n  )\n# width_plot\n```\n:::\n\n\n\n\n### Combined Plot:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot1 <- leaves_plot + \n  theme(axis.text.y = element_text(size = 8)) +\n  theme(axis.title.x = element_blank())\n\nplot2 <- height_plot +\n  theme(axis.text.y = element_text(size = 8)) +\n  theme(axis.title.x = element_blank())\n\nplot3 <- length_plot +\n  theme(axis.text.y = element_text(size = 8)) +\n  theme(axis.title.x = element_blank())\n\nplot4 <- width_plot +\n  theme(axis.text.y = element_text(size = 8)) +\n  theme(axis.title.x = element_blank())\n```\n:::\n\n\n\n\nBased on our visual exploration, we can see that while the species are very similar, there are species differentiation observed when examining green leaves and canopy length.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncombinedplot <- plot1 + plot2 + plot3 + plot4\ncombinedplot\n```\n\n::: {.cell-output-display}\n![Comparison of species Sabal etonia and Serenoa repens reveals differences and similarities in predictor variables. In combined boxplots, (counter-clockwise from left) we observe a higher count of green leaves in S. repens. In canopy length, we see greater canopy length in S. etonia. Canopy width and height exhibit similar counts.](index_files/figure-html/fig-combined_plot-1.png){#fig-combined_plot width=672}\n:::\n:::\n\n\n\n\n# Models:\n\nTo determine whether a plant is *Serenoa repens* or *Sabal etonia*, we need to conduct a binary logistic regression using several predictor variables. We will perform the analysis twice comparing the following models:\n\n-   Model 1: The log odds of plant type using plant height, canopy length, canopy width, and green leaves as predictor variables.\n-   Model 2: The log odds of plant type using plant height, canopy width, and green leaves (excluding canopy length for this model).\n\nNote that *S. repens* = speices 1 and *S. etonia* = species 2.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Define formulas:\nf1 <- species ~ height + length + width + green_lvs\nf2 <- species ~ height + width + green_lvs\n\n# BLR:\nblr1 <- glm(formula = f1, data = palmetto, family = binomial)\n\nblr2 <- glm(formula = f2, data = palmetto, family = binomial)\n\n# # Summarize:\n# summary(blr1)\n# summary(blr2)\n```\n:::\n\n\n\n\nThe coefficients from the binary logistic regression analysis offer insights into the log odds of the predictor variables. In model f1, all predictors have p-values \\< 0.5, indicating significance. However, upon removing canopy height from the model in f2, the p-value for height is \\> 0.5, suggesting it is no longer a suitable predictor variable. Additionally, Model f1 presents an AIC of 5194.6, while f2 shows an AIC of 5987.5, indicating that f1 is the preferred model.\n\n# Repeated Cross Validation:\n\nNext we need to utilize repeated cross-validation (ten-fold cross-validation) using tidymodels for both models.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Set seed\nset.seed(10101)\n\n# Create folds:\nsurv_folds <- vfold_cv(palmetto, v = 10, repeats = 10)\n\n# Default: \nblr_mdl <- logistic_reg() %>%\n  set_engine('glm') \n\n# Workflows:\nblr_wf1 <- workflow() %>%  \n  add_model(blr_mdl) %>%\n  add_formula(f1)\n\nblr_wf2 <- workflow() %>%  \n  add_model(blr_mdl) %>%\n  add_formula(f2)\n\n#apply to folded datasetls: \nblr_fit_folds1 <- blr_wf1 %>%\n  fit_resamples(surv_folds)\n\nblr_fit_folds2 <- blr_wf2 %>%\n  fit_resamples(surv_folds)\n\n# blr_fit_folds1\n# blr_fit_folds2\n\n# # Metrics:\n# collect_metrics(blr_fit_folds1)\n# collect_metrics(blr_fit_folds2)\n```\n:::\n\n\n\n\nThe metrics show:\n\n-   F1 has a mean accuracy of approximately 92% and a mean ROC of approximately 97%.\n-   F2 has a mean accuracy of approximately 90% and a mean ROC of approximately 96%.\n\nBased on these metrics, F1 appears to be the better performing model, as it has higher values for both accuracy and ROC.\n\n# Train on Full Dataset:\n\nNow that we have decided the F1 is the better predicting model, we want to train the model on the entire dataset.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nblr_fit_full <- blr_mdl %>%\n  fit(formula = f1, data = palmetto)\n\npalmetto_predict <- palmetto %>% \n  mutate(predict(blr_fit_full,new_data = .))\n```\n:::\n\n\n\n\nThe results of the BLR model are presented below:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Broom::Tidy \ntidy_output <- tidy(blr_fit_full)\n\n# Create kable table with title\ncoef_table <- kable(tidy_output, align = \"c\")%>%\n  kable_styling() \n\ncoef_table\n```\n\n::: {#fig-table .cell-output-display}\n<table class=\"table\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:center;\"> term </th>\n   <th style=\"text-align:center;\"> estimate </th>\n   <th style=\"text-align:center;\"> std.error </th>\n   <th style=\"text-align:center;\"> statistic </th>\n   <th style=\"text-align:center;\"> p.value </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:center;\"> (Intercept) </td>\n   <td style=\"text-align:center;\"> 3.2266851 </td>\n   <td style=\"text-align:center;\"> 0.1420708 </td>\n   <td style=\"text-align:center;\"> 22.71180 </td>\n   <td style=\"text-align:center;\"> 0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> height </td>\n   <td style=\"text-align:center;\"> -0.0292173 </td>\n   <td style=\"text-align:center;\"> 0.0023061 </td>\n   <td style=\"text-align:center;\"> -12.66984 </td>\n   <td style=\"text-align:center;\"> 0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> length </td>\n   <td style=\"text-align:center;\"> 0.0458233 </td>\n   <td style=\"text-align:center;\"> 0.0018661 </td>\n   <td style=\"text-align:center;\"> 24.55600 </td>\n   <td style=\"text-align:center;\"> 0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> width </td>\n   <td style=\"text-align:center;\"> 0.0394434 </td>\n   <td style=\"text-align:center;\"> 0.0021000 </td>\n   <td style=\"text-align:center;\"> 18.78227 </td>\n   <td style=\"text-align:center;\"> 0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> green_lvs </td>\n   <td style=\"text-align:center;\"> -1.9084747 </td>\n   <td style=\"text-align:center;\"> 0.0388634 </td>\n   <td style=\"text-align:center;\"> -49.10728 </td>\n   <td style=\"text-align:center;\"> 0 </td>\n  </tr>\n</tbody>\n</table>\n\n\n\nBinary logistic regression results for the F1 model applied to the entire Palmetto dataset.\n:::\n:::\n\n\n\n\nTo assess the model's accuracy for identifying plant species correctly, we need to introduce a conditional argument: if the predicted probability is greater than or equal to 50%, the plant is classified as species 1; otherwise, it is classified as species 2. We can then construct a table illustrating the count of correctly and incorrectly classified plants from the original dataset by the model, as well as a column displaying the percentage of plants correctly classified.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calculate predicted species based on probabilities and 50% cutoff\npalmetto_predict_prob<- augment(blr_fit_full, new_data = palmetto, type.predict = 'response') %>% \n    mutate(predicted_species = ifelse(.pred_1 >= 0.5, \"1\", \"2\")) %>%\n  select(predicted_species, everything())\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create a table of observed and predicted species\n\n# results_table <- table(palmetto_predict_prob %>% \n#   select(predicted_species, species))\n# \n# tidy(results_table)\n\nspecies <- c('S. Repens', 'S. Etonia')\npredict_correct <- c(5548,5701)\npredict_incorrect <- c(564,454)\npercent_correct <- c(91,93)\n\n# Create the data frame\nspecies_correct <- data.frame(species, predict_correct, predict_incorrect, percent_correct)\n\n#kable it\nspecies_correct_kable <- kable(species_correct, align = \"c\") %>%\n  kable_styling() \n\nspecies_correct_kable\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:center;\"> species </th>\n   <th style=\"text-align:center;\"> predict_correct </th>\n   <th style=\"text-align:center;\"> predict_incorrect </th>\n   <th style=\"text-align:center;\"> percent_correct </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:center;\"> S. Repens </td>\n   <td style=\"text-align:center;\"> 5548 </td>\n   <td style=\"text-align:center;\"> 564 </td>\n   <td style=\"text-align:center;\"> 91 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> S. Etonia </td>\n   <td style=\"text-align:center;\"> 5701 </td>\n   <td style=\"text-align:center;\"> 454 </td>\n   <td style=\"text-align:center;\"> 93 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\n\n# Reference:\n\nAbrahamson, W.G. 2019. Survival, growth and biomass estimates of two dominant palmetto species of south-central Florida from 1981 - 2017, ongoing at 5-year intervals ver 1. Environmental Data Initiative. https://doi.org/10.6073/pasta/f2f96ec76fbbd4b9db431c79a770c4d5\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"../../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}